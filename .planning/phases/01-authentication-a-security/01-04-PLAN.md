---
phase: 01-authentication-a-security
plan: 04
type: execute
wave: 4
depends_on: ["01-03"]
files_modified: []
autonomous: false

must_haves:
  truths:
    - "User can log in with valid credentials"
    - "User remains logged in across browser sessions"
    - "User can log out from dashboard"
    - "All API routes reject unauthenticated requests with 401"
    - "Access token auto-refreshes before expiration"
  artifacts: []
  key_links: []
---

<objective>
Verify complete authentication flow works end-to-end.

Purpose: Human verification that all authentication requirements are met before marking Phase 1 complete.

Output: Confirmed working authentication system meeting all success criteria.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/01-authentication-a-security/01-03-SUMMARY.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>
Complete authentication system with:
- Backend: JWT auth, secure sessions, protected API routes
- Frontend: Login form, auth state management, automatic token refresh
- Security: HttpOnly cookies, session regeneration, rate limiting, security headers
  </what-built>

  <how-to-verify>
**Setup:**
1. Generate secrets if not already done:
   ```bash
   cd backend
   chmod +x scripts/generate-secrets.sh
   echo "your_password" | ./scripts/generate-secrets.sh
   ```

2. Set environment variables in backend/.env:
   ```
   ADMIN_USER=admin
   FRONTEND_URL=http://localhost:5173
   ```

3. Start backend and frontend:
   ```bash
   # Terminal 1
   cd backend && npm run dev

   # Terminal 2
   cd frontend && npm run dev
   ```

**Test Flow:**

**1. Login Flow:**
- Visit http://localhost:5173
- Expected: Login form displayed
- Enter username: admin, password: (your generated password)
- Expected: Dashboard appears, see time entries

**2. Session Persistence:**
- Refresh browser (F5)
- Expected: Still logged in, dashboard visible (no login form)

**3. Protected API Routes:**
- Open DevTools Network tab
- Click sync or any dashboard action
- Expected: API requests include Authorization header
- Try API in new incognito window:
  ```bash
  curl http://localhost:3000/api/stats
  ```
- Expected: 401 Unauthorized

**4. Token Refresh:**
- Wait 15+ minutes (or temporarily change JWT expiresIn to '1m' in backend/src/plugins/auth.ts to speed up testing)
- Interact with dashboard (trigger an API call)
- Expected: Request succeeds (token auto-refreshed), no logout

**5. Logout:**
- Click logout button in dashboard header
- Expected: Redirected to login form
- Try accessing dashboard or API
- Expected: Login form shown, API returns 401

**6. Invalid Credentials:**
- Enter wrong password
- Expected: Error message shown, remain on login form

**7. Rate Limiting:**
- Submit wrong password 6 times in a row
- Expected: After 5 attempts, receive rate limit error (429 or similar)
- Wait 15 minutes or restart server to reset

**Success Checklist:**
- [ ] Login with valid credentials works
- [ ] Login with invalid credentials shows error
- [ ] Dashboard visible after login
- [ ] Session persists across page refresh
- [ ] Logout clears session
- [ ] Unauthenticated API requests return 401
- [ ] Token auto-refresh works (no forced logout at 15min)
- [ ] Rate limiting prevents brute force (max 5 login attempts)
  </how-to-verify>

  <resume-signal>
Type "approved" if all checks pass, or describe any issues found for debugging.
  </resume-signal>
</task>

</tasks>

<verification>
Manual testing checklist completed successfully.
</verification>

<success_criteria>
All Phase 1 success criteria from ROADMAP.md verified:
1. User can log in with username and password ✓
2. User remains logged in across browser sessions ✓
3. User can log out from any page ✓
4. All API routes require valid authentication ✓
5. Unauthenticated requests are rejected with 401 ✓
</success_criteria>

<output>
After completion, create `.planning/phases/01-authentication-a-security/01-04-SUMMARY.md`
</output>
