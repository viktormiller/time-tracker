---
phase: 07-foundation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - frontend/src/App.tsx
  - frontend/src/pages/Utilities.tsx
  - frontend/src/components/utilities/EmptyState.tsx
  - frontend/src/components/utilities/MeterTabs.tsx
autonomous: true

must_haves:
  truths:
    - "User can click Utilities in the navigation header to open the utilities section"
    - "Utilities section shows empty state with CTA when no meters exist"
    - "Utilities section shows tabs for meter types (Strom, Gas, Wasser Warm) when meters exist"
    - "Utilities section inherits dark mode and authentication from existing app"
  artifacts:
    - path: "frontend/src/pages/Utilities.tsx"
      provides: "Main utilities page with state management and tab routing"
      min_lines: 50
    - path: "frontend/src/components/utilities/EmptyState.tsx"
      provides: "Empty state illustration and CTA button"
      min_lines: 20
    - path: "frontend/src/components/utilities/MeterTabs.tsx"
      provides: "Tab navigation for meter types"
      min_lines: 30
  key_links:
    - from: "frontend/src/App.tsx"
      to: "frontend/src/pages/Utilities.tsx"
      via: "currentView state conditional render"
      pattern: "currentView.*utilities"
    - from: "frontend/src/pages/Utilities.tsx"
      to: "frontend/src/components/utilities/EmptyState.tsx"
      via: "conditional render when no meters"
      pattern: "EmptyState"
    - from: "frontend/src/pages/Utilities.tsx"
      to: "frontend/src/components/utilities/MeterTabs.tsx"
      via: "conditional render when meters exist"
      pattern: "MeterTabs"
---

<objective>
Add the Utilities section to the frontend navigation and create the page shell with empty state, tab navigation, and overall layout -- all independent of the backend API (using placeholder state).

Purpose: Establishes the frontend structure for utility tracking. Can be built in parallel with the database schema (Plan 01) since it uses placeholder data for now.
Output: Working navigation to Utilities section with empty state and tab structure visible.
</objective>

<execution_context>
@/Users/vmiller/.claude/get-shit-done/workflows/execute-plan.md
@/Users/vmiller/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-foundation/07-CONTEXT.md
@.planning/phases/07-foundation/07-RESEARCH.md
@frontend/src/App.tsx
@frontend/src/pages/Estimates.tsx
@frontend/src/hooks/useTheme.tsx
@frontend/src/hooks/useToast.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Utilities navigation to App.tsx</name>
  <files>frontend/src/App.tsx</files>
  <action>
Make minimal, targeted changes to App.tsx (IMPORTANT: keep changes under 20-30 new lines per RESEARCH anti-pattern guidance):

1. **Import the Utilities page** at the top with other page imports:
```typescript
import { Utilities } from './pages/Utilities';
```

2. **Extend the currentView union type** (line ~115) to include 'utilities':
```typescript
const [currentView, setCurrentView] = useState<'dashboard' | 'add-entry' | 'settings' | 'estimates' | 'utilities'>('dashboard');
```

3. **Add the Utilities nav button** in the header. Place it BEFORE the Estimates button (after the separator div, before the Estimates button around line 484). Use the `Gauge` icon from lucide-react (add to the import at the top). Follow the exact same button pattern as Estimates:
```typescript
{/* UTILITIES BUTTON */}
<button
  onClick={() => setCurrentView('utilities')}
  className={`flex items-center gap-2 px-3 py-2 ${
    currentView === 'utilities'
      ? 'text-indigo-600 dark:text-indigo-400 bg-indigo-50 dark:bg-indigo-900/30'
      : 'text-gray-600 dark:text-gray-300 hover:bg-gray-100 dark:hover:bg-gray-700'
  } rounded-lg transition text-sm font-medium`}
  title="Verbrauch"
>
  <Gauge size={18} />
  <span className="hidden md:inline">Verbrauch</span>
</button>
```

Note the active state styling (indigo when selected) which matches the CONTEXT decision that utilities should feel like part of the same app.

4. **Add the view routing conditional** (between the estimates conditional around line 444 and the dashboard return):
```typescript
// Render Utilities page if selected
if (currentView === 'utilities') {
  return (
    <Utilities onBack={() => setCurrentView('dashboard')} />
  );
}
```

5. **Add `Gauge` to the lucide-react import** at the top of App.tsx.

IMPORTANT: Do NOT add any utility business logic to App.tsx. Only navigation wiring.
  </action>
  <verify>
Run `cd frontend && npx tsc --noEmit` (will need Utilities.tsx to exist first -- verify after Task 2).
Visually confirm that App.tsx changes are minimal (less than 30 new lines).
  </verify>
  <done>App.tsx has Utilities in its view union type, a nav button with active state styling, and a conditional render for the Utilities page component.</done>
</task>

<task type="auto">
  <name>Task 2: Create Utilities page shell with EmptyState and MeterTabs components</name>
  <files>frontend/src/pages/Utilities.tsx, frontend/src/components/utilities/EmptyState.tsx, frontend/src/components/utilities/MeterTabs.tsx</files>
  <action>
Create the `frontend/src/components/utilities/` directory and three component files.

**1. EmptyState.tsx** (`frontend/src/components/utilities/EmptyState.tsx`):
A welcoming empty state shown when no meters exist. Follow the app's existing Tailwind dark mode patterns.

Props: `{ onCreateMeter: () => void }`

Content:
- Centered layout with generous padding
- A simple illustration using lucide-react icons (use `Gauge` and `Plus` icons in a decorative arrangement -- a large Gauge icon with a subtle background circle)
- Heading: "Verbrauch erfassen" (Track your utility meters)
- Subtext: "Erstellen Sie Ihren ersten Zahler, um Strom-, Gas- oder Warmwasserverbrauch zu verfolgen." (Create your first meter to track electricity, gas, or hot water consumption.)
- CTA button: "Ersten Zahler erstellen" (Create First Meter) -- styled as primary button (indigo background, white text, hover state)
- Full dark mode support using existing Tailwind patterns (dark:bg-gray-800, dark:text-gray-100, etc.)

**2. MeterTabs.tsx** (`frontend/src/components/utilities/MeterTabs.tsx`):
Tab navigation for switching between meter types.

Props:
```typescript
interface MeterTabsProps {
  activeTab: string;
  onTabChange: (tab: string) => void;
  meterCounts: { STROM: number; GAS: number; WASSER_WARM: number };
}
```

Tabs: Three tabs labeled "Strom", "Gas", "Wasser Warm". Each shows count badge if > 0.
- Active tab: indigo underline/highlight with dark mode variant
- Inactive tabs: gray text with hover
- Use Tailwind classes consistent with existing app styling
- Tab labels map: STROM -> "Strom", GAS -> "Gas", WASSER_WARM -> "Wasser Warm"
- Icons per tab (from lucide-react): STROM -> `Zap`, GAS -> `Flame`, WASSER_WARM -> `Droplets`

**3. Utilities.tsx** (`frontend/src/pages/Utilities.tsx`):
Main page component following the Estimates.tsx pattern (same page layout with back button header).

Props: `{ onBack: () => void }`

Structure:
- Page layout matching Estimates.tsx: same min-h-screen, max-w-7xl, padding, background
- Header with back arrow button (`ArrowLeft` icon, calls onBack) and title "Verbrauch" (Utilities)
- State management:
  - `meters`: array of meter objects (empty array initially -- will be populated by API in Plan 04)
  - `activeTab`: string defaulting to 'STROM'
  - `loading`: boolean
  - `showMeterForm`: boolean (for create meter modal -- modal itself comes in Plan 04)
- Conditional rendering:
  - If `meters.length === 0` and not loading: show `<EmptyState onCreateMeter={() => setShowMeterForm(true)} />`
  - If meters exist: show `<MeterTabs>` above content area, with a placeholder div saying "Readings will appear here" for now (Plan 04 adds the actual table)
- Include an "Add Reading" button in the header area (disabled/placeholder for now -- styled but functionality comes in Plan 04)
- Include a "+" button for creating a new meter (next to the title)

Define TypeScript interfaces at the top of the file for the data types that will be used:
```typescript
interface Meter {
  id: string;
  type: string;
  name: string;
  unit: string;
  location: string | null;
  deletedAt: string | null;
  createdAt: string;
  updatedAt: string;
}

interface MeterReading {
  id: string;
  readingDate: string;
  value: number;
  consumption: number | null;
  unit: string;
  photoPath: string | null;
  notes: string | null;
  createdAt: string;
}
```

These interfaces will be used across Plan 04 components too. For now they define the shape of data the page expects.
  </action>
  <verify>
Run `cd frontend && npx tsc --noEmit` -- should compile without TypeScript errors.
Run `cd frontend && npm run build` -- should build successfully.
The navigation should render the Utilities button in the header and clicking it should show the Utilities page with the empty state.
  </verify>
  <done>Utilities page renders with empty state when no meters exist. Tab navigation component is ready for use. Navigation button appears in the app header with proper active state styling. All components support dark mode.</done>
</task>

</tasks>

<verification>
- `cd frontend && npm run build` succeeds
- App.tsx has fewer than 30 new lines added
- Clicking "Verbrauch" in nav shows Utilities page
- Empty state displays with CTA button
- Dark mode works correctly on all new components
- Back button returns to dashboard
</verification>

<success_criteria>
- Utilities navigation button visible in header between theme toggle and Estimates
- Clicking Utilities shows the Utilities page (not the dashboard)
- Empty state shows illustration, heading, subtext, and CTA button
- MeterTabs component renders three tabs with icons
- All components inherit dark mode from ThemeProvider
- Page authenticated (only visible when logged in)
</success_criteria>

<output>
After completion, create `.planning/phases/07-foundation/07-02-SUMMARY.md`
</output>
