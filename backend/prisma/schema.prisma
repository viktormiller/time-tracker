generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Unified model for all time entries
model TimeEntry {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  source      String   // "TOGGL" | "TEMPO" | "MANUAL"
  externalId  String?  // Optional ID from external system
  date        DateTime @db.Timestamptz(6) // The actual date of work (includes start time)
  duration    Float    // Duration in hours (decimal)
  project     String?  // e.g. "forHim" or "WEKA-199"
  description String?  // Task description
  startTime   String?  // Optional: start time in HH:mm format (for manual entries)
  endTime     String?  // Optional: end time in HH:mm format (for manual entries)
  createdAt   DateTime @default(now()) @db.Timestamptz(6)

  // Kombinierter Unique Index
  // Ein Eintrag ist eindeutig durch seine Quelle und seine externe ID.
  @@unique([source, externalId])
  @@index([date])
}

model ProjectEstimate {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clientName     String
  name           String
  estimatedHours Float
  notes          String?
  createdAt      DateTime @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime @updatedAt @db.Timestamptz(6)
  projects       EstimateProject[]
}

model EstimateProject {
  id          String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  estimateId  String          @db.Uuid
  projectName String
  estimate    ProjectEstimate @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  @@unique([estimateId, projectName])
  @@index([projectName])
}
