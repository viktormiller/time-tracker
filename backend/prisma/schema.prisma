generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-arm64-openssl-3.0.x", "debian-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// Unified model for all time entries
model TimeEntry {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  source      String   // "TOGGL" | "TEMPO" | "MANUAL"
  externalId  String?  // Optional ID from external system
  date        DateTime @db.Timestamptz(6) // The actual date of work (includes start time)
  duration    Float    // Duration in hours (decimal)
  project     String?  // e.g. "forHim" or "WEKA-199"
  description String?  // Task description
  startTime   String?  // Optional: start time in HH:mm format (for manual entries)
  endTime     String?  // Optional: end time in HH:mm format (for manual entries)
  createdAt   DateTime @default(now()) @db.Timestamptz(6)

  // Kombinierter Unique Index
  // Ein Eintrag ist eindeutig durch seine Quelle und seine externe ID.
  @@unique([source, externalId])
  @@index([date])
}

model ProjectEstimate {
  id             String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  clientName     String
  name           String
  estimatedHours Float
  notes          String?
  createdAt      DateTime @default(now()) @db.Timestamptz(6)
  updatedAt      DateTime @updatedAt @db.Timestamptz(6)
  projects       EstimateProject[]
}

model EstimateProject {
  id          String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  estimateId  String          @db.Uuid
  projectName String
  estimate    ProjectEstimate @relation(fields: [estimateId], references: [id], onDelete: Cascade)
  @@unique([estimateId, projectName])
  @@index([projectName])
}

model Property {
  id        String    @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  name      String
  address   String?
  movedIn   DateTime? @db.Date
  movedOut  DateTime? @db.Date
  createdAt DateTime  @default(now()) @db.Timestamptz(6)
  updatedAt DateTime  @updatedAt @db.Timestamptz(6)
  meters    Meter[]
}

model Meter {
  id         String          @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  type       String          // "STROM" | "GAS" | "WASSER_WARM"
  name       String
  unit       String          // "kWh" or "m3"
  location   String?
  propertyId String          @db.Uuid
  deletedAt  DateTime?       @db.Timestamptz(6)
  createdAt  DateTime        @default(now()) @db.Timestamptz(6)
  updatedAt  DateTime        @updatedAt @db.Timestamptz(6)
  property   Property        @relation(fields: [propertyId], references: [id])
  readings   MeterReading[]

  @@index([type])
  @@index([deletedAt])
  @@index([propertyId])
}

model MeterReading {
  id          String   @id @default(dbgenerated("gen_random_uuid()")) @db.Uuid
  meterId     String   @db.Uuid
  readingDate DateTime @db.Date
  value       Float
  photoPath   String?
  notes       String?
  createdAt   DateTime @default(now()) @db.Timestamptz(6)
  meter       Meter    @relation(fields: [meterId], references: [id])

  @@unique([meterId, readingDate])
  @@index([meterId, readingDate])
}
